# README

## Code Origins
Stars code - Ian

tIMDB code - Eyal
## Division of Labor
We mostly worked together on this project, but split up the work as follows:

Ian
- Combining the stars/timdb code
- "map" command
- "nearest" command
- "ways" command

Eyal
- Set up connection to database
- added AStar search functionality
- "route" command

## Known Bugs
None

However, we do have 3 checkstyle errors because of magic numbers. One of these
errors is being thrown on a hashcode method generated by Intellij. The other
two are being thrown on lines 111-112 in WorldDatabase.java where we set
the values of variables in an sql query. We need to use the numbers 7 and 8
to set the values of variables at those indices in the query, so I don't
think these checkstyle errors are valid.

## Design Details
### Packages

- **repl**: contains the Main class, the REPL class, and the Executable interface. 
The REPL takes in a Map of from string to executable (these executables evaluate
the user inputted arg and return a string to be printed to the REPL). 

- **stars**: contains classes related only to the Stars project (a CSV parser,
Star class, and a central hub class "StarControl", as well as a simplified
testing class Cartesian)

- **timdb**: contains classes related only to timdb (actor classes and actor
database connection, and the executable implementing classes for "mdb" and
"connect")

- **maps**: contains classes implementing executables for each command in the
"executables" subpackage and classes to do with storing world information
(nodes, ways, database, graph)
    - world
    
        - We have a class "World" that contains information about the world:
        a connection to the map database, a kd tree storing world nodes, and
        a graph to use to explore routes between nodes. A WorldNode is the
        class to store the information stored in the "node" table in the
        database schema, and a WorldEdge is the class to store the connection
        between nodes, found in the "way" table.

- **kdtree**: contains classes for kd tree functionality (to be used in Stars
and in Nearest)

- **graph**: contains interfaces pertaining to graphs that can be used in any project

- **distance**: contains interface for distance measurements as well as some classes
that implement different distance measurements (euclidean, haversine, axis, etc)

- **comparators**: contains interface for graph comparators as well as different
comparators to be used throughout the project

- **algorithms**: contains interface for shortest path algorithms and a class
that implements that interface (Dijkstra). Dijkstra has a comparator and a 
graph in its constructor so it can run the astar or dijkstra comparator to find 
the shortest path in a graph.


### Maps
- **map**: Implemented in the MapExecutable class.
When this command is called, the program sets up a database connection
to the file of the inputted filepath and then queries to get all traversable nodes
in the database and puts those nodes into a kd tree to allow the nearest
command to function. If there is an error connecting to the database or querying
for the nodes, an error message is displayed

- **nearest**: Implemented in the Nearest class. 
When this command is called, the program uses the kd-tree generated
when map was called to find the 1st nearest neighbor to the inputted location.
This means making a call to tree.getNearestNeighbors(). 

- **ways**: Implemented in the Ways class.
When this command is called, the program determines whether the
bounding box described by the two input points is valid, then makes a query
to the database to find all ways with an endpoint within the bounding box. We
do not use the kd tree for this because it seemed unnecessary when an SQL
query works faster.

- **route**: Implemented in the Route class.
When the command is called, the execute method first make sure that the input
 is a valid input for the command based on the specification, and classifies
  the input into a coordinate input or street name input. It then either gets
   the nearest node to the coordinates or finds the intersection (if it
    exists) of the street/cross street inputs for both the source and the
     destination. It then calls the search command with the target node as an
      argument on the graph with the source node as the root. It then returns
       the output path. 

### Combining code
To combine Eyal's tIMDB code and Ian's Stars code, we used Eyal's REPL structure,
and so only had to adapt my functionality classes (in StarControl) to implement
Eyal's Executable interface. We abstracted the KDTree class, so that it could
store any class implementing a Coordinates interface (so a class that could
return a double array of coordinates) and our Graph class took in classes
that implement a GraphNode interface. In order to combine these functionalities
in maps, we had our WorldNode class implement both the Coordinates interface and
the GraphNode interface. Thus both our graph and kd tree could be of type
WorldNode.

### Optimizations
- Caching ids of nodes to node objects in WorldDatabase
- Caching nodes to their edges in WorldDatabase
- Loading in all the nodes into a kdtree when the database is loaded. This made
    nearest, ways, and route much faster.

### Running Tests
To run the Java unit tests enter "mvn test" in the terminal in the project directory.

To run all our system tests enter "./cs32-test src/test/student/maps/*.test -t 60" 
in the terminal in the project directory.

### Tests
To test, we did both system tests and unit tests. We created several different
small maps databases, some malformed, and others with untraversable nodes and tried
to cover all of the different cases for each command. To aid with testing, we
drew out a diagram of the smallMaps graph and attempted to pick different
cases for each command.

#### Unit Tests 
- Our unit tests are in src/test/java/edu/brown/cs/ilayzer/maps
- GraphAlgTest contains tests for different cases of the AStar algorithm to verify
that the algorithm is being executed correctly.
- WorldDatabaseTest tests all of the methods for accessing the database
- ExecutablesTest tests the executables (MapsExecutable, Route, Ways, Nearest).
The reason we did not make this file very extensive is because it is basically
equivalent to system testing, and so we did not attempt to cover all of the cases
that we covered already in the system tests.
- In the stars and tIMDB folders there are unit tests pertaining to the code 
pertaining to those projects (KDTree for stars, and the database and timdb commands
for tIMDB)

#### System Tests 
- Located in src/test/student/maps
- We have comprehensive system tests for all the different commands for maps
called on several different databases including both the small and large maps
data set. We tried to hit different error cases as well as the different normal
functionality cases.

### Building and running
To build the project from the command line, enter "mvn package" from the project directory.
To run the project, enter "./run" after building or "./run --gui" to run with GUI.
The GUI will not have maps functionality built in. 

### Browser
Used Chrome







